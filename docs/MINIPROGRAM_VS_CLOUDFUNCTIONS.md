# miniprogram å’Œ cloudfunctions çš„å…³ç³»

## ğŸ—ï¸ æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¾®ä¿¡å°ç¨‹åºç”¨æˆ·ç«¯                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  miniprogram/                                        â”‚  â”‚
â”‚  â”‚  â”œâ”€ pages/          (UIé¡µé¢ - ç”¨æˆ·çœ‹åˆ°çš„ç•Œé¢          â”‚  â”‚
â”‚  â”‚  â”œâ”€ utils/api.js    (APIè°ƒç”¨å±‚ - å’Œåç«¯é€šè®¯)          â”‚  â”‚
â”‚  â”‚  â”œâ”€ app.js          (åˆå§‹åŒ–CloudBase)                â”‚  â”‚
â”‚  â”‚  â””â”€ ...             (å…¶ä»–é¡µé¢å’Œæ ·å¼)                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â†“â†“â†“ wx.cloud.callFunction() â†“â†“â†“                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚      å¾®ä¿¡ CloudBase åç«¯           â”‚
            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
            â”‚  â”‚  cloudfunctions/             â”‚â”‚
            â”‚  â”‚  â”œâ”€ login/                   â”‚â”‚  (äº‘å‡½æ•°å±‚ - å¤„ç†ä¸šåŠ¡é€»è¾‘)
            â”‚  â”‚  â”œâ”€ updateRankings/          â”‚â”‚
            â”‚  â”‚  â””â”€ progressSeason/          â”‚â”‚
            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
            â”‚             â†“â†“â†“                  â”‚
            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
            â”‚  â”‚  CloudBase æ•°æ®åº“             â”‚â”‚
            â”‚  â”‚  â”œâ”€ users                    â”‚â”‚
            â”‚  â”‚  â”œâ”€ groups                   â”‚â”‚
            â”‚  â”‚  â”œâ”€ matches                  â”‚â”‚
            â”‚  â”‚  â”œâ”€ season_rankings          â”‚â”‚
            â”‚  â”‚  â””â”€ ...                      â”‚â”‚
            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± miniprogram (å°ç¨‹åºå‰ç«¯)

**ä½ç½®**: `d:\src\HeadToHead\miniprogram\`

**ä½œç”¨**: ç”¨æˆ·çœ‹åˆ°çš„ç•Œé¢ã€ç”¨æˆ·äº¤äº’

**åŒ…å«å†…å®¹**:
```
miniprogram/
â”œâ”€â”€ app.js                    â† åˆå§‹åŒ–CloudBaseè¿æ¥
â”œâ”€â”€ pages/                    â† æ‰€æœ‰UIé¡µé¢
â”‚   â”œâ”€â”€ index/               â† é¦–é¡µ
â”‚   â”œâ”€â”€ group/detail.js      â† Groupè¯¦æƒ…é¡µ
â”‚   â””â”€â”€ match/upload.js      â† æ¯”èµ›ä¸Šä¼ é¡µ
â”œâ”€â”€ utils/api.js             â† å’Œåç«¯é€šè®¯çš„APIå‡½æ•°
â””â”€â”€ ...
```

**ä¸»è¦èŒè´£**:
1. æ˜¾ç¤ºUIç»™ç”¨æˆ·
2. æ”¶é›†ç”¨æˆ·è¾“å…¥ (å¦‚ä¸Šä¼ æ¯”èµ›)
3. **è°ƒç”¨äº‘å‡½æ•°æˆ–è®¿é—®æ•°æ®åº“**
4. æ˜¾ç¤ºè¿”å›çš„æ•°æ®

**ä»£ç ç¤ºä¾‹ - ä¸Šä¼ æ¯”èµ›**:
```javascript
// miniprogram/pages/match/upload-singles.js

// ç”¨æˆ·ç‚¹å‡»"ä¸Šä¼ æ¯”èµ›"æŒ‰é’®
handleUpload() {
  // 1. æ”¶é›†ç”¨æˆ·è¾“å…¥çš„æ•°æ®
  const matchData = {
    groupId: this.data.groupId,
    opponent: this.data.selectedOpponent,
    score: this.data.score
  };

  // 2. è°ƒç”¨APIå‡½æ•° (åœ¨utils/api.jsä¸­å®šä¹‰)
  api.createSinglesMatch(matchData)
    .then(result => {
      // 3. æ˜¾ç¤ºæˆåŠŸæç¤º
      wx.showToast({ title: 'ä¸Šä¼ æˆåŠŸ' });
    });
}
```

---

## â˜ï¸ cloudfunctions (åç«¯äº‘å‡½æ•°)

**ä½ç½®**: `d:\src\HeadToHead\cloudfunctions\`

**ä½œç”¨**: å¤„ç†å¤æ‚ä¸šåŠ¡é€»è¾‘ã€å®šæ—¶ä»»åŠ¡ã€æ•°æ®è®¡ç®—

**åŒ…å«å†…å®¹**:
```
cloudfunctions/
â”œâ”€â”€ login/                    â† å¤„ç†ç”¨æˆ·ç™»å½•
â”œâ”€â”€ updateRankings/           â† è®¡ç®—æ’å (æ¯30åˆ†é’Ÿè‡ªåŠ¨è¿è¡Œ)
â””â”€â”€ progressSeason/           â† èµ›å­£æ¨è¿› (æ¯å¤©å‡Œæ™¨è‡ªåŠ¨è¿è¡Œ)
```

**ä¸»è¦èŒè´£**:
1. å¤„ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ (å°ç¨‹åºæ— æ³•åšçš„)
2. å®šæ—¶ä»»åŠ¡ (å¦‚æ¯30åˆ†é’Ÿæ›´æ–°æ’å)
3. è®¿é—®æ•°æ®åº“ (æœåŠ¡å™¨ç«¯å®‰å…¨è®¿é—®)
4. è¿”å›å¤„ç†ç»“æœç»™å°ç¨‹åº

**ä»£ç ç¤ºä¾‹ - æ’åè®¡ç®—äº‘å‡½æ•°**:
```javascript
// cloudfunctions/updateRankings/index.js

exports.main = async (event, context) => {
  // è¿™ä¸ªå‡½æ•°æ¯30åˆ†é’Ÿè‡ªåŠ¨è¿è¡Œä¸€æ¬¡
  // å°ç¨‹åºæ— æ³•æ‰‹åŠ¨è°ƒç”¨æ’åè®¡ç®—

  // 1. è·å–æ‰€æœ‰æ¯”èµ›æ•°æ®
  const matches = await db.collection('matches')
    .where({ status: 'approved' })
    .get();

  // 2. åœ¨æœåŠ¡å™¨ç«¯è®¡ç®—æ’å (å¤æ‚ç®—æ³•)
  const rankings = calculateRankings(matches.data);

  // 3. ä¿å­˜æ’ååˆ°æ•°æ®åº“
  rankings.forEach(r => {
    db.collection('season_rankings').add(r);
  });

  return { code: 0, message: 'æ’åæ›´æ–°å®Œæˆ' };
};
```

---

## ğŸ”„ é€šè®¯è¿‡ç¨‹è¯¦è§£

### åœºæ™¯1: ç”¨æˆ·ä¸Šä¼ æ¯”èµ› (å°ç¨‹åº â†’ äº‘å‡½æ•° â†’ æ•°æ®åº“)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ä¸€æ­¥: ç”¨æˆ·åœ¨å°ç¨‹åºä¸­ä¸Šä¼ æ¯”èµ›                          â”‚
â”‚ miniprogram/pages/match/upload-singles.js              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬äºŒæ­¥: å°ç¨‹åºè°ƒç”¨API                                  â”‚
â”‚ wx.cloud.callFunction({                               â”‚
â”‚   name: 'createSinglesMatch',                         â”‚
â”‚   data: { score: { set1: { a: 6, b: 4 } } }         â”‚
â”‚ })                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ä¸‰æ­¥: äº‘å‡½æ•°å¤„ç†è¯·æ±‚                                â”‚
â”‚ cloudfunctions/createSinglesMatch/index.js            â”‚
â”‚ - éªŒè¯æ•°æ®                                            â”‚
â”‚ - ä¿å­˜åˆ°æ•°æ®åº“                                        â”‚
â”‚ - è¿”å›ç»“æœç»™å°ç¨‹åº                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬å››æ­¥: å°ç¨‹åºæ”¶åˆ°ç»“æœï¼Œæ˜¾ç¤ºæˆåŠŸæç¤º                   â”‚
â”‚ wx.showToast({ title: 'ä¸Šä¼ æˆåŠŸ' })                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åœºæ™¯2: æ’åè‡ªåŠ¨æ›´æ–° (å®šæ—¶è¿è¡Œäº‘å‡½æ•°)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¯30åˆ†é’Ÿè‡ªåŠ¨è§¦å‘ (ä¸éœ€è¦ç”¨æˆ·æ“ä½œ)                      â”‚
â”‚ CloudBase å®šæ—¶å™¨ â†’ è¿è¡Œ updateRankings äº‘å‡½æ•°          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äº‘å‡½æ•°è¿è¡Œ                                             â”‚
â”‚ cloudfunctions/updateRankings/index.js                â”‚
â”‚ 1. è·å–æ‰€æœ‰approvedçš„æ¯”èµ›                             â”‚
â”‚ 2. è®¡ç®—æ’åç®—æ³•                                       â”‚
â”‚ 3. æ›´æ–°season_rankingsé›†åˆ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æ‰“å¼€å°ç¨‹åºæŸ¥çœ‹æ’å                                â”‚
â”‚ - æ’åå·²è‡ªåŠ¨æ›´æ–°                                      â”‚
â”‚ - æ— éœ€ç”¨æˆ·åšä»»ä½•äº‹æƒ…                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š å¯¹æ¯”æ€»ç»“

| é¡¹ç›® | miniprogram | cloudfunctions |
|------|------------|-----------------|
| **ä½ç½®** | å¾®ä¿¡å°ç¨‹åºå®¢æˆ·ç«¯ | CloudBaseæœåŠ¡å™¨ |
| **è¯­è¨€** | JavaScript (å°ç¨‹åºè¯­æ³•) | JavaScript (Node.js) |
| **èƒ½åšä»€ä¹ˆ** | æ˜¾ç¤ºUIã€æ”¶é›†è¾“å…¥ã€è°ƒç”¨åç«¯ | å¤„ç†å¤æ‚é€»è¾‘ã€å®šæ—¶ä»»åŠ¡ã€å®‰å…¨æ“ä½œ |
| **èƒ½å¦è®¿é—®æ•°æ®åº“** | âœ… å¯ä»¥ (éœ€è¦æƒé™é…ç½®) | âœ… å¯ä»¥ (å®Œå…¨æ§åˆ¶) |
| **èƒ½å¦å®šæ—¶è¿è¡Œ** | âŒ ä¸èƒ½ | âœ… å¯ä»¥ (å®šæ—¶è§¦å‘) |
| **æ€§èƒ½** | å—æ‰‹æœºæ€§èƒ½é™åˆ¶ | æœåŠ¡å™¨æ€§èƒ½ï¼Œæ— é™åˆ¶ |
| **å®‰å…¨æ€§** | ä»£ç æš´éœ²åœ¨å®¢æˆ·ç«¯ | ä»£ç éšè—åœ¨æœåŠ¡å™¨ |
| **ç”¨æˆ·çœ‹å¾—åˆ°å—** | âœ… çœ‹å¾—åˆ° (UIå’Œé€»è¾‘) | âŒ çœ‹ä¸åˆ° (åå°è¿è¡Œ) |

---

## ğŸ”— å…·ä½“çš„è°ƒç”¨å…³ç³»

### åœ¨å°ç¨‹åºä¸­å¦‚ä½•è°ƒç”¨äº‘å‡½æ•°

**æ–¹å¼1: ç›´æ¥è°ƒç”¨äº‘å‡½æ•°**

```javascript
// miniprogram/pages/index/index.js
wx.cloud.callFunction({
  name: 'login',  // äº‘å‡½æ•°åç§°
  data: {},
  success: res => {
    console.log('ç™»å½•æˆåŠŸ:', res.result.openid);
  }
});
```

**æ–¹å¼2: é€šè¿‡APIå°è£…è°ƒç”¨**

```javascript
// miniprogram/utils/api.js
const getUserOrCreate = async (openid, userInfo) => {
  const db = wx.cloud.database();
  // ç›´æ¥æ“ä½œæ•°æ®åº“ï¼Œä¸éœ€è¦è°ƒç”¨äº‘å‡½æ•°
  const result = await db.collection('users').doc(openid).get();
  return result.data;
};

// miniprogram/pages/index/index.js
import api from '../../utils/api.js';

api.getUserOrCreate(openid, userInfo).then(user => {
  console.log('ç”¨æˆ·ä¿¡æ¯:', user);
});
```

---

## ğŸ¯ ä½•æ—¶ç”¨miniprogramï¼Œä½•æ—¶ç”¨cloudfunctions

### ç”¨miniprogramåš:
- âœ… æ˜¾ç¤ºUIé¡µé¢
- âœ… æ”¶é›†ç”¨æˆ·è¾“å…¥
- âœ… ç®€å•çš„æ•°æ®éªŒè¯
- âœ… æ˜¾ç¤ºæ•°æ®

### ç”¨cloudfunctionsåš:
- âœ… **å¤æ‚çš„æ’åè®¡ç®—** (éœ€è¦éå†æ‰€æœ‰æ¯”èµ›ã€æ’åºç­‰)
- âœ… **å®šæ—¶ä»»åŠ¡** (èµ›å­£æ¨è¿›ã€æ’åæ›´æ–°)
- âœ… **å®‰å…¨çš„æ•°æ®æ“ä½œ** (ä¸èƒ½åœ¨å®¢æˆ·ç«¯æš´éœ²)
- âœ… **å¤šè¡¨äº‹åŠ¡å¤„ç†** (åŒæ—¶æ›´æ–°å¤šä¸ªé›†åˆ)

---

## ğŸ’¡ åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­

### miniprogramåšäº†ä»€ä¹ˆ:
```javascript
// 1. æ˜¾ç¤ºGroupåˆ—è¡¨ (pages/index/index.js)
// 2. æ˜¾ç¤ºæ’åè¡¨æ ¼ (pages/group/detail.js)
// 3. ä¸Šä¼ æ¯”èµ›è¡¨å• (pages/match/upload-singles.js)
// 4. å®¡æ ¸æ¯”èµ› (pages/group/detail.js)

// éƒ½æ˜¯UIå±‚é¢çš„å·¥ä½œ
```

### cloudfunctionsåšäº†ä»€ä¹ˆ:
```javascript
// 1. è®¡ç®—æ’å (cloudfunctions/updateRankings)
//    - éå†æ‰€æœ‰æ¯”èµ›
//    - è®¡ç®—èƒœè´Ÿå’Œæœ€è¿‘5åœºèƒœç‡
//    - æ’åºç”Ÿæˆæ’å
//    - æ¯30åˆ†é’Ÿè‡ªåŠ¨è¿è¡Œ

// 2. èµ›å­£æ¨è¿› (cloudfunctions/progressSeason)
//    - æ£€æŸ¥èµ›å­£å¼€å§‹æ—¶é—´
//    - çŠ¶æ€è½¬æ¢ pendingâ†’activeâ†’endedâ†’settled
//    - è‡ªåŠ¨è®¡ç®—èµ›å­£å¥–é¡¹
//    - æ¯å¤©å‡Œæ™¨2ç‚¹è‡ªåŠ¨è¿è¡Œ

// éƒ½æ˜¯åå°å¤„ç†å·¥ä½œ
```

---

## ğŸš€ å®é™…å·¥ä½œæµç¨‹

### ç”¨æˆ·å®Œæ•´æµç¨‹:

```
1. æ‰“å¼€å°ç¨‹åº (miniprogram/app.js åˆå§‹åŒ–)
            â†“
2. å¾®ä¿¡ç™»å½• (è°ƒç”¨ cloudfunctions/login)
            â†“
3. æŸ¥çœ‹Groupåˆ—è¡¨ (miniprogram æ˜¾ç¤º users å’Œ groups æ•°æ®)
            â†“
4. è¿›å…¥æŸä¸ªGroup (miniprogram æ˜¾ç¤ºæ’å)
            â†“
5. ä¸Šä¼ æ¯”èµ› (miniprogram æ”¶é›†æ•°æ® â†’ ä¿å­˜åˆ° matches é›†åˆ)
            â†“
6. å¯¹æ‰‹å®¡æ ¸ (miniprogram å®¡æ ¸ â†’ æ›´æ–° matches çŠ¶æ€ä¸º approved)
            â†“
7. [30åˆ†é’Ÿå] cloudfunctions/updateRankings è‡ªåŠ¨è¿è¡Œ
            â†“
8. ç”¨æˆ·åˆ·æ–°æ’åé¡µ (miniprogram æ˜¾ç¤ºå·²æ›´æ–°çš„æ’å)
```

---

## ğŸ“ æ–‡ä»¶å¯¹åº”å…³ç³»

| åŠŸèƒ½ | miniprogramæ–‡ä»¶ | cloudfunctionsæ–‡ä»¶ | æ•°æ®åº“é›†åˆ |
|------|---------------|------------------|----------|
| ç”¨æˆ·ç™»å½• | pages/auth/login.js | login/ | users |
| Groupç®¡ç† | pages/group/detail.js | (æ— ) | groups, group_members |
| æ¯”èµ›ä¸Šä¼  | pages/match/upload-singles.js | (æ— ) | matches |
| æ’åè®¡ç®— | pages/group/detail.jsæ˜¾ç¤º | **updateRankings/** | season_rankings |
| èµ›å­£æ¨è¿› | (æ— ï¼Œåå°) | **progressSeason/** | seasons, season_awards |

---

## âœ… æ€»ç»“

**miniprogram** = ç”¨æˆ·ç•Œé¢å’Œäº¤äº’
**cloudfunctions** = åå°ä¸šåŠ¡é€»è¾‘å’Œå®šæ—¶ä»»åŠ¡

å®ƒä»¬é€šè¿‡ **CloudBase** è¿æ¥åœ¨ä¸€èµ·ï¼Œå°ç¨‹åºé€šè¿‡APIè°ƒç”¨äº‘å‡½æ•°æˆ–ç›´æ¥æ“ä½œæ•°æ®åº“ã€‚

**ç±»æ¯”**:
- miniprogram = ç”µå½±çš„å‰å° (æ¼”å‘˜ã€èˆå°)
- cloudfunctions = ç”µå½±çš„åå° (å¯¼æ¼”ã€ç¼–å‰§ã€æŠ€æœ¯äººå‘˜)
- CloudBase = ç”µå½±çš„åŸºç¡€è®¾æ–½ (èˆå°ã€ç¯å…‰ã€éŸ³å“)
