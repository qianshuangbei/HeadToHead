# HeadToHead 网球Group排名小程序 - 开发团队快速入门指南

**项目名称**: HeadToHead (H2H)
**版本**: MVP v1.0
**发布时间**: 2025-10-27
**开发周期**: 12-16周

---

## 📋 文档导航

| 文档 | 用途 | 阅读人群 |
|-----|-----|---------|
| **DESIGN_DOC.md** | 完整产品设计文档 | 所有人必读 |
| **DEVELOPER_GUIDE.md** | 本文件，快速入门 | 项目负责人、技术lead |
| **API_SPEC.md** | API详细规范(待生成) | 后端开发 |
| **DB_SCHEMA.md** | 数据库完整Schema(待生成) | DBA、后端开发 |
| **FRONTEND_SPEC.md** | 前端页面规范(待生成) | 前端开发 |

---

## 🎯 MVP核心价值

**解决问题**: 每个网球社区需要一个轻量级、灵活的排名系统
**用户规模**: 100人(MVP阶段)
**核心特性**:
- ✅ Group隔离排名(社区自治)
- ✅ 双方认可的比赛录入审核机制(数据可信)
- ✅ 赛季制激励(CSGO风格)
- ✅ 实时排名更新

---

## 🚀 项目启动前 Checklist

### 1. 技术栈确认

```
✓ 前端
  - 微信小程序框架: Taro / 原生 / uni-app (请选择)
  - 状态管理: Redux / MobX / Pinia
  - 组件库: WeUI / vant-weapp (可选)
  - 开发环境: Node.js v16+

✓ 后端
  - 框架: Node.js Express / Java Spring / Go Gin (请选择)
  - 数据库: MySQL 8.0
  - 缓存: Redis 6.0+
  - 消息队列: RabbitMQ / Redis Stream

✓ 基础设施
  - 服务器: 云服务商(腾讯云/阿里云/AWS)
  - 域名 & SSL证书
  - CDN(可选，MVP不需要)
  - 监控告警: Prometheus / Datadog
```

### 2. 团队结构建议

```
项目经理 x1
  ├─ 后端负责人 x1
  │   ├─ API开发 x2
  │   ├─ 数据库/缓存 x1
  │   └─ 基础设施/DevOps x1
  │
  ├─ 前端负责人 x1
  │   ├─ 小程序开发 x2
  │   └─ UI/UX设计 x1
  │
  └─ QA x1

总计: 8-10人, 12-16周交付
```

### 3. 开发环境准备

```bash
# 版本控制
git init
git branch -b develop

# Node.js项目结构
backend/
  ├─ src/
  │   ├─ controllers/
  │   ├─ services/
  │   ├─ models/
  │   ├─ routes/
  │   └─ middleware/
  ├─ tests/
  ├─ config/
  └─ package.json

frontend/
  ├─ src/
  │   ├─ pages/
  │   ├─ components/
  │   ├─ services/
  │   └─ utils/
  ├─ project.config.json
  └─ package.json
```

---

## 📅 开发阶段计划

### 第1-2周: 需求评审 + 基础设施准备

**后端**:
- [ ] 数据库环境搭建(本地 + 测试 + 预发)
- [ ] Redis缓存配置
- [ ] 项目框架搭建(Express / Spring / Gin)
- [ ] 认证模块(JWT + 微信OAuth2)
- [ ] 数据库migration脚本

**前端**:
- [ ] 小程序项目初始化
- [ ] UI设计稿评审
- [ ] 页面结构规划

**质量**:
- [ ] 测试环境搭建
- [ ] CI/CD流程设计

---

### 第3-5周: 后端核心功能

**优先级排序(P0必做)**:
1. [ ] User认证 API (登录、获取用户信息)
2. [ ] Group管理 API (创建、加入、获取成员)
3. [ ] Match创建与审核 API (单打+双打)
4. [ ] Ranking计算与查询 API
5. [ ] Season管理 API

**关键实现点**:
- [ ] JWT token生成与验证(24h自动刷新)
- [ ] 排名实时计算算法(SQL优化)
- [ ] 比赛状态机(pending → approved/rejected)
- [ ] 赛季自动推进定时任务

**交付物**:
- [ ] 核心API规范文档(Swagger/OpenAPI)
- [ ] 数据库Schema脚本
- [ ] 单元测试覆盖率 > 80%

---

### 第6-8周: 前端 + 集成

**前端页面实现**(按优先级):
1. [ ] 登录页 (微信授权)
2. [ ] 首页 (我的Group列表 + 创建/加入)
3. [ ] Group详情页 (排名、成员、赛季)
4. [ ] 比赛录入页 (单打/双打表单)
5. [ ] 排名详情页 (玩家详情、历史比赛)
6. [ ] 比赛审核页 (待审核列表 + 审核界面)

**后端补充**:
- [ ] 消息通知系统(微信模板消息)
- [ ] 权限检查中间件(role-based)
- [ ] 错误处理 & 日志系统

**集成测试**:
- [ ] API + 前端联调
- [ ] 排名计算逻辑验证(100+场景)
- [ ] 比赛approve/reject流程测试

**交付物**:
- [ ] 前后端可正常交互的staging环境
- [ ] 集成测试报告

---

### 第9-10周: 测试 + 优化

**功能测试**:
- [ ] 核心功能逐项验收
- [ ] 边界场景测试(并发、数据一致性)
- [ ] 微信小程序真机测试

**性能优化**(100人规模目标):
- [ ] 排名查询 < 500ms
- [ ] 比赛提交 < 1s
- [ ] 排名更新 < 100ms
- [ ] 数据库查询优化(添加必要索引)

**灰度测试**:
- [ ] 邀请20-50个种子用户
- [ ] 收集反馈 + 快速迭代

**交付物**:
- [ ] 测试报告
- [ ] 性能基准数据
- [ ] 用户反馈汇总

---

### 第11周: 微信审核 + 文案优化

**微信小程序审核准备**:
- [ ] 隐私政策(获取头像、昵称、手机号)
- [ ] 用户协议
- [ ] 功能描述(中英文)
- [ ] 截图 & 视频演示(5张)

**文案优化**:
- [ ] 按钮文案审核
- [ ] 错误提示信息优化
- [ ] 帮助文档编写

**提交微信审核**:
- [ ] 审核通常需要 2-7天
- [ ] 预留备选方案(如审核被拒)

---

### 第12周: 上线发布

**发布前最后检查**:
- [ ] 数据库备份策略
- [ ] 灾难恢复计划(RTO/RPO)
- [ ] 监控告警配置完成
- [ ] 运维手册编写

**灰度上线**:
- [ ] 10% 用户流量
- [ ] 监控24h无异常
- [ ] 逐步扩大到100%

**上线后**:
- [ ] 24h on-call支持
- [ ] 关键指标监控(DAU、crash率等)
- [ ] 用户反馈收集

---

## 🔑 关键技术决策

### 排名实时更新 vs 异步更新

**决策**: **实时更新** (每次approved时立即重算)

**理由**:
- 100人规模完全可承受
- 用户体验更好(立即看到排名变化)
- 代码逻辑简洁

**实现方式**:
```
比赛approve流程:
1. 前端提交approve请求
2. 后端验证权限 + 更新match status
3. 触发排名重算(SQL或内存)
4. 缓存排名到Redis
5. 发送通知给双方
6. 返回更新后的排名
```

---

### 赛季自动推进

**决策**: **后端定时任务** (每天凌晨检查)

**实现方式**:
```
每日00:05执行:
1. 查询所有pending且start_date=今天的赛季 → 转为active
2. 查询所有active且end_date=今天的赛季 → 转为ended
3. 记录操作日志
4. 发送赛季开始/结束通知
```

---

### 比赛审核权限

**决策**: **严格权限检查** (确保数据完整性)

**规则**:
```
单打:
- player_a提交 → 需要player_b approve (且approval_status=pending)
- 若player_b拒绝 → player_a可重新提交

双打:
- 任一参赛者可提交 → 其他3人需要逐一approve
- 全部approve后才能入库
- 任一人拒绝 → 所有人重置为pending

特殊情况:
- 管理员可直接approve任何比赛(P1)
- 超时24h后可申诉到管理员(P1)
```

---

## ⚡ 性能目标(100人规模)

| 指标 | 目标 | 备注 |
|-----|-----|-----|
| 排名页加载 | < 500ms | 包含排序 + 最近5场 |
| 比赛提交 | < 1s | 包括校验 + 通知 |
| 排名更新 | < 100ms | approve时立即计算 |
| 数据库查询 | < 50ms(P99) | 需要索引优化 |
| 并发用户 | 100+ 无卡顿 | 连接池 + 缓存 |

**优化策略**:
- Redis缓存排名(每次更新后立即写入)
- 数据库索引(group_id, season_id, user_id等)
- 排名计算避免全表扫描(按season_id分组)
- API响应使用分页(列表类)

---

## 🔒 安全与合规

### 认证与授权

```
微信登录流程:
1. 前端调用wx.login() → 获得code
2. 后端用code + secret换取session_key
3. 后端生成JWT token返回前端
4. 前端后续请求在header中携带token
5. 后端验证token有效性

Token刷新:
- 有效期: 24小时
- 刷新机制: 快要过期时自动刷新
- 刷新令牌: 也需要持久化存储
```

### 数据隐私

```
用户数据收集:
- ✓ 头像URL、昵称 (功能必需)
- ✓ 手机号 (微信授权可选，建议不要强制)
- ✓ OpenID (用于识别用户)

数据访问:
- 用户只能看到自己加入的Group
- 用户只能看到该Group内的排名
- 其他Group的数据严格隔离
- 管理员可查看所有Group数据(P1)
```

### 防作弊

```
MVP版本依赖人工审核:
- 对手approve才能入库
- 两方都能看到比赛细节
- 若数据有问题，对手可拒绝

P1版本考虑:
- 用户信任度评分(拒绝率)
- 异常检测(连续大比分)
- 申诉流程
```

---

## 📦 数据库迁移策略

### 本地开发
```bash
npm run migrate:create -- --name init_schema
npm run migrate:up  # 应用迁移
npm run migrate:down  # 回滚
```

### 测试环境
```
1. 创建migrations目录
2. 每个功能模块一个migration文件
3. 编号规范: 001_init_schema.sql, 002_add_groups.sql
4. 包含up和down脚本(支持回滚)
5. 每个migration都要测试过回滚
```

### 生产环境
```
1. 预发环境验证通过后才能发布
2. 备份完整数据库
3. 低谷时段执行(如凌晨)
4. 监控migration执行时间(需要< 5分钟)
5. 失败自动回滚
```

---

## 🧪 测试策略

### 单元测试
- **目标**: 核心业务逻辑覆盖率 > 80%
- **框架**: Jest / Mocha
- **范围**:
  - 排名计算算法
  - 状态转移逻辑
  - 权限检查

### 集成测试
- **目标**: 关键功能流程验证
- **测试用例** (最少):
  - [ ] 用户登录 → 创建Group → 邀请成员
  - [ ] 上传单打比赛 → 对手审核 → 排名更新
  - [ ] 上传双打比赛 → 所有人审核 → 排名更新
  - [ ] 赛季创建 → 自动推进 → 结算奖项
  - [ ] 权限检查(普通成员不能删成员等)
  - [ ] 并发情况(2个对手同时上传相同比赛)

### E2E测试(小程序真机)
- **框架**: Playwright / Puppeteer(微信)
- **场景**:
  - 完整用户旅程(登录→创建→比赛→查看排名)
  - 性能基准(排名页加载时间)
  - 离线恢复(断网后重连)

### 性能测试
- **工具**: Apache JMeter / Locust
- **场景**:
  - 100并发用户查看排名
  - 10并发用户同时提交比赛
  - 数据库连接池饱和测试

---

## 📊 关键指标监控

### 应用级指标
```
✓ DAU (日活用户)
✓ 比赛提交数/天
✓ 审核通过率(> 90%)
✓ 人均参赛频率
✓ 用户留存率(Day-1, Day-7, Day-30)
```

### 技术指标
```
✓ API 响应时间 (P50, P95, P99)
✓ 错误率 (< 0.1%)
✓ 数据库连接数
✓ Redis命中率 (> 80%)
✓ 服务器CPU/内存/磁盘使用
```

### 业务指标
```
✓ 比赛数据一致性(定期校验)
✓ 排名准确性(抽样验证)
✓ 用户投诉率
✓ 微信审核通过率
```

---

## 🚨 风险与应对

| 风险 | 概率 | 影响 | 应对 |
|-----|-----|-----|-----|
| 微信审核被拒 | 中 | 发布延期 | 提前准备备选方案 |
| 排名计算错误 | 低 | 严重 | 充分单元测试 + 抽样校验 |
| 并发数据冲突 | 低 | 中 | 数据库乐观锁 / 版本号 |
| 性能瓶颈 | 中 | 中 | 预压测试 + 缓存策略 |
| 用户数增长快 | 中 | 长期 | 架构可扩展设计 |

---

## 📞 沟通机制

### 日常沟通
- **每日Standup**: 15min, 上午10:00
- **周会**: 1h, 每周五下午
- **Slack/钉钉**: 技术问题实时讨论

### 决策流程
- 功能需求: 产品经理评估 → 技术评审 → 开发
- 技术方案: 技术lead评审 → 团队讨论 → 确定
- 线上问题: 值班人员 → 技术lead → 24h内修复

### 文档维护
- Design Doc: 每周三更新
- API文档: 每个API合并时必须更新Swagger
- Runbook(运维手册): 每个功能上线前编写

---

## ✅ 上线清单

在发布生产前，确保完成以下项目:

```
功能
- [ ] 所有P0功能完成
- [ ] 没有已知的Critical/High Bug
- [ ] 代码Review通过率100%

质量
- [ ] 单元测试覆盖率 > 80%
- [ ] 集成测试全部通过
- [ ] 性能测试达标(见性能目标)
- [ ] 安全审计完成

运维
- [ ] 监控告警配置完成
- [ ] 日志系统正常工作
- [ ] 数据库备份验证
- [ ] 灾难恢复计划确认

合规
- [ ] 微信小程序通过审核
- [ ] 隐私政策 & 用户协议发布
- [ ] 法务评审完成

文档
- [ ] 技术文档完整
- [ ] 运维手册完成
- [ ] 用户帮助文档上线

团队准备
- [ ] 值班表安排(24h支持)
- [ ] on-call人员培训
- [ ] 应急预案演练
```

---

## 🎓 推荐阅读

1. **产品设计**: [DESIGN_DOC.md](DESIGN_DOC.md) - 完整功能设计
2. **API规范**: REST Best Practices, OpenAPI 3.0 spec
3. **微信小程序**: [微信官方文档](https://developers.weixin.qq.com/miniprogram)
4. **数据库**: MySQL优化、索引设计、事务隔离
5. **缓存**: Redis最佳实践、缓存穿透/击穿/雪崩
6. **监控**: Prometheus、ELK Stack、APM

---

## 📞 联系方式

- **产品经理**: [名字] - 产品设计、需求澄清
- **技术Lead**: [名字] - 技术方案、架构决策
- **项目经理**: [名字] - 进度跟踪、风险管理

---

**最后更新**: 2025-10-27
**版本**: 1.0
**所有者**: HeadToHead 项目组

🚀 **准备好开始了吗？Let's Build!**
