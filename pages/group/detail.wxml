<!--pages/group/detail.wxml-->
<view class="container">
  <!-- Groupä¿¡æ¯å¤´ -->
  <view class="group-header">
    <view class="header-top">
      <view class="group-title">
        <text class="name">{{group.name}}</text>
        <text class="member-count">{{group.member_count}}ä¸ªæˆå‘˜</text>
      </view>
      <button class="btn-leave-icon" bindtap="handleLeaveGroup">
        <text class="icon-exit">ğŸ‘‰ğŸšª</text>
      </button>
    </view>
    <view class="share-code">
      <text>åˆ†äº«ç : {{group.access_code}}</text>
      <button class="btn-copy" bindtap="copyAccessCode">å¤åˆ¶</button>
    </view>
  </view>

  <!-- æ ‡ç­¾æ  -->
  <view class="tabs">
    <view class="tab {{activeTab === 'ranking' ? 'active' : ''}}" bindtap="switchTab" data-tab="ranking">
      æ’å
    </view>
    <view class="tab {{activeTab === 'matches' ? 'active' : ''}}" bindtap="switchTab" data-tab="matches">
      æ¯”èµ›
    </view>
    <view class="tab {{activeTab === 'members' ? 'active' : ''}}" bindtap="switchTab" data-tab="members">
      æˆå‘˜
    </view>
  </view>

  <!-- æ’åæ ‡ç­¾é¡µ -->
  <view class="tab-content" wx:if="{{activeTab === 'ranking'}}">
    <!-- èµ›å­£é€‰æ‹©å™¨ -->
    <view class="season-selector" wx:if="{{seasons.length > 0}}">
      <picker bindchange="onSeasonChange" value="{{currentSeasonIndex}}" range="{{seasons}}" range-key="season_name">
        <view class="picker">
          <text>å½“å‰èµ›å­£: {{seasons[currentSeasonIndex].season_name}}</text>
          <text class="status {{seasons[currentSeasonIndex].status}}">{{seasons[currentSeasonIndex].status}}</text>
        </view>
      </picker>
    </view>

    <!-- æ’åè¡¨ -->
    <view class="ranking-table" wx:if="{{rankings.length > 0}}">
      <view class="ranking-header">
        <text class="col-rank">æ’å</text>
        <text class="col-player">é€‰æ‰‹</text>
        <text class="col-wins">èƒœ</text>
        <text class="col-rate">èƒœç‡</text>
      </view>
      <view class="ranking-row" wx:for="{{rankings}}" wx:key="user_id">
        <text class="col-rank">{{item.rank}}</text>
        <text class="col-player">{{item.playerName}}</text>
        <text class="col-wins">{{item.wins}}</text>
        <text class="col-rate">{{item.win_rate | formatRate}}</text>
      </view>
    </view>

    <!-- æ’åç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:else>
      <text>æš‚æ— æ’åæ•°æ®</text>
      <text>ä¸Šä¼ æ¯”èµ›åæ’åå°†å®æ—¶æ›´æ–°</text>
    </view>
  </view>

  <!-- æ¯”èµ›æ ‡ç­¾é¡µ -->
  <view class="tab-content" wx:if="{{activeTab === 'matches'}}">
    <view class="action-buttons">
      <button class="btn btn-primary" bindtap="handleUploadMatch">ä¸Šä¼ æ¯”åˆ†</button>
    </view>

    <!-- å¾…å®¡æ ¸æ¯”èµ› -->
    <view class="pending-section" wx:if="{{pendingMatches.length > 0}}">
      <text class="section-title">å¾…æˆ‘å®¡æ ¸ ({{pendingMatches.length}})</text>
      <view class="match-card" wx:for="{{pendingMatches}}" wx:key="_id">
        <view class="match-info">
          <text class="opponent">{{item.opponentName}}</text>
          <text class="score">{{item.score.set1.player_a}}-{{item.score.set1.player_b}}</text>
        </view>
        <view class="match-actions">
          <button class="btn-approve" bindtap="approveMatch" data-match-id="{{item._id}}">ç¡®è®¤</button>
          <button class="btn-reject" bindtap="rejectMatch" data-match-id="{{item._id}}">æ‹’ç»</button>
        </view>
      </view>
    </view>

    <!-- æœ€è¿‘æ¯”èµ› -->
    <view class="recent-section" wx:if="{{recentMatches.length > 0}}">
      <text class="section-title">æœ€è¿‘æ¯”èµ›</text>
      <view class="match-card" wx:for="{{recentMatches}}" wx:key="_id">
        <view class="match-info">
          <text class="opponent">{{item.opponentName}}</text>
          <text class="score">{{item.score.set1.player_a}}-{{item.score.set1.player_b}}</text>
        </view>
        <text class="status {{item.status}}">{{item.status}}</text>
      </view>
    </view>
  </view>

  <!-- æˆå‘˜æ ‡ç­¾é¡µ -->
  <view class="tab-content" wx:if="{{activeTab === 'members'}}">
    <view class="members-list">
      <view class="member-item" wx:for="{{members}}" wx:key="user_id">
        <image class="avatar" src="{{item.display_avatar}}" mode="aspectFill"></image>
        <view class="member-info">
          <text class="name">{{item.nickname}}</text>
          <text class="role">{{item.isCreator ? 'åˆ›å»ºè€…' : 'æˆå‘˜'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="bottom-actions">
    <button class="btn btn-primary" wx:if="{{group.creator_id == openid}}" bindtap="handleCreateSeason">åˆ›å»ºæ–°èµ›å­£</button>
  </view>
</view>
